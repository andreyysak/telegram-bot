generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  user_id           Int           @id @default(autoincrement())
  email             String?       @unique
  phone             String?       @unique
  telegram_name     String?
  telegram_username String?
  telegram_user_id  String        @unique
  country           String?
  city              String?
  image             String?
  created_at        DateTime      @default(now())
  accounts          Account[]
  categories        Category[]
  fuels             Fuel[]
  maintenances      Maintenance[]
  transactions      Transaction[]
  trips             Trip[]
  wishList          WishList[]
}

model Fuel {
  gas_id     Int      @id @default(autoincrement())
  user_id    Int
  liters     Float
  price      Float
  station    String   @db.VarChar(255)
  created_at DateTime @default(now())
  updated_at DateTime @default(now()) @updatedAt
  user       User     @relation(fields: [user_id], references: [user_id], onDelete: Cascade)

  @@index([user_id])
}

model Maintenance {
  maintenance_id Int      @id @default(autoincrement())
  user_id        Int
  date           DateTime
  description    String   @db.Text
  odometer       Int
  created_at     DateTime @default(now())
  updated_at     DateTime @default(now()) @updatedAt
  user           User     @relation(fields: [user_id], references: [user_id], onDelete: Cascade)

  @@index([user_id])
}

model Trip {
  trip_id          Int      @id @default(autoincrement())
  telegram_user_id String
  kilometrs        Float
  direction        String   @db.Text
  created_at       DateTime @default(now())
  updated_at       DateTime @updatedAt
  user             User     @relation(fields: [telegram_user_id], references: [telegram_user_id], onDelete: Cascade)

  @@index([telegram_user_id])
}

model Account {
  account_id      Int           @id @default(autoincrement())
  mono_account_id String?       @unique
  user_id         Int
  name            String
  currency        String        @default("UAH")
  balance         Float         @default(0)
  created_at      DateTime      @default(now())
  user            User          @relation(fields: [user_id], references: [user_id], onDelete: Cascade)
  transactions    Transaction[]

  @@index([user_id])
}

model Category {
  category_id  Int           @id @default(autoincrement())
  user_id      Int
  name         String
  type         String
  user         User          @relation(fields: [user_id], references: [user_id], onDelete: Cascade)
  transactions Transaction[]

  @@index([user_id])
}

model Transaction {
  transaction_id Int      @id @default(autoincrement())
  user_id        Int
  account_id     Int
  category_id    Int
  amount         Float
  description    String?  @db.Text
  date           DateTime @default(now())
  account        Account  @relation(fields: [account_id], references: [account_id], onDelete: Cascade)
  category       Category @relation(fields: [category_id], references: [category_id], onDelete: Cascade)
  user           User     @relation(fields: [user_id], references: [user_id], onDelete: Cascade)

  @@index([user_id])
  @@index([account_id])
}

model FuelPriceHistory {
  id         Int      @id @default(autoincrement())
  station    String
  fuel_type  String
  price      Float
  created_at DateTime @default(now())

  @@index([station])
  @@index([created_at])
}

model CurrencyHistory {
  id         Int      @id @default(autoincrement())
  code       String
  rate_buy   Float
  rate_sell  Float
  created_at DateTime @default(now())

  @@index([code])
  @@index([created_at])
}

model WishList {
  wish_id    Int      @id @default(autoincrement())
  user_id    Int
  url        String
  title      String?
  price      Float?
  image_url  String?
  category   String   @default("General")
  created_at DateTime @default(now())

  user User @relation(fields: [user_id], references: [user_id], onDelete: Cascade)
}
